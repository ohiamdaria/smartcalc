#include "calculate.h"

double calc(char *s) {
    double d =  0.0l;;
    double otvet = 0.0l;
    Stack_number num;
    init_stackn(&num);
    while(*s != '\0') {
        while(check_priority(*s) == 5 || *s == ' ') {
            if (check_priority(*s) == 5) {
                d = *s - '0';
                pushn(&num, d);
            }
            s++;
        }
        switch(*s) {
            case '+':
                otvet = popn(&num) + popn(&num);
                pushn(&num, otvet);
                break;
            case '-': ;
                double d1 = popn(&num);
                double d2 = popn(&num);
                otvet = d2 - d1;
                pushn(&num, otvet);
                break;
            case '*':
                otvet = popn(&num) * popn(&num);
                pushn(&num, otvet);
                printn(&num);
                break;
            case '/':
                double d3 = popn(&num);
                double d4 = popn(&num);
                otvet = d4 / d3;
                pushn(&num, otvet);
                break;
            case 'i': // sin
                otvet = sin(popn(&num));
                pushn(&num, otvet);
                break;
            case 'o': // cos
                otvet = cos(popn(&num));
                pushn(&num, otvet);
                break;
            case 'a':
                otvet = tan(popn(&num));
                pushn(&num, otvet);
                break;
            case 's':
                otvet = asin(popn(&num));
                pushn(&num, otvet);
                break;
            case 'c':
                otvet = acos(popn(&num));
                pushn(&num, otvet);
                break;
            case 't':
                otvet = atan(popn(&num));
                pushn(&num, otvet);
                break;
            case 'g':
                otvet = log(popn(&num));
                pushn(&num, otvet);
                break;  
            case 'q':
                otvet = sqrt(popn(&num));
                pushn(&num, otvet);
                break;
            case 'n':
                otvet = ln(popn(&num));
                pushn(&num, otvet);
                break;  
        }
        s++;
    }
    printf("otvet: %.6lf\n", otvet);
    return otvet;
}